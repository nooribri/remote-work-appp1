<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>ØªÙ‚Ø§Ø±ÙŠØ±ÙŠ</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px; 
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
    }

    .header {
      margin-top: 30px;
      margin-bottom: 25px;
    }

    .header h2 {
      font-size: 24px;
      margin-bottom: 15px;
    }

    .search-container {
      margin-bottom: 20px;
    }

    .search-container input {
      padding: 12px 40px 12px 12px;
      font-size: 16px;
      border-radius: 6px;
      border: 1px solid #ccc;
      width: 320px;
      direction: rtl;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      direction: rtl;
      margin-bottom: 60px;
    }

    th {
      background-color: #26a69a;
      color: white;
      padding: 12px;
      border: 1px solid #ccc;
      text-align: center;
    }

    tbody tr:nth-child(odd) {
      background-color: #e0f7f7;
    }

    tbody tr:nth-child(even) {
      background-color: #ffffff;
    }

    td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: center;
      word-break: break-word;
    }

  @media print {
  /* Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ÙÙ„ØªØ±Ø© */
  .search-container {
    display: none !important;
  }

  /* Ø¥Ø®ÙØ§Ø¡ Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© ÙˆØ§Ù„ØªØµØ¯ÙŠØ± ÙˆØ§Ù„Ø±Ø¬ÙˆØ¹ */
  #buttons {
    display: none !important;
  }

  /* Ø¥Ø®ÙØ§Ø¡ Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª */
  th:last-child,
  td:last-child {
    display: none !important;
  }
}

@media print {
  @page {
    margin: 10mm; /* ØªÙ‚Ø¯Ø± ØªÙ‚Ù„Ù„Ù‡Ø§ Ø£ÙƒØ«Ø± */
  }

  body {
    margin: 0 !important;
    padding: 0 !important;
  }
}


    button {
      margin: 5px;
      padding: 8px 16px;
      background-color: #26a69a;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
    }

    button:hover {
      background-color: #00796b;
    }

    .delete-button {
      color: red;
      font-weight: bold;
      background: none;
      border: none;
      cursor: pointer;
    }

    #buttons {
      position: fixed;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      background: #fff;
      padding: 10px 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      z-index: 100;
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      justify-content: center;
      max-width: 95vw;
    }
  </style>
</head>
<body>

  <div class="header">
    <h2>ØªÙ‚Ø±ÙŠØ± Ù…Ù‡Ù…Ø© Ø¹Ù…Ù„</h2>
  </div>

 <div class="search-container">
  <select id="departmentFilter" onchange="filterByDepartment()" style="padding: 10px; border-radius: 6px; margin-bottom: 10px;">
    <option value="">ğŸ“‚ Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</option>
    <option>Ù‚Ø³Ù… Ù…ÙƒØªØ¨ Ø§Ù„Ù…Ø¯ÙŠØ±</option>
    <option>Ù‚Ø³Ù… ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</option>
    <option>Ù‚Ø³Ù… Ø§Ù„Ø´Ø¤ÙˆÙ† Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ© ÙˆØ§Ù„Ù…Ø§Ù„ÙŠØ©</option>
    <option>Ù‚Ø³Ù… Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª ÙˆØ§Ù„ØªØ·ÙˆÙŠØ±</option>
    <option>Ù‚Ø³Ù… Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰</option>
    <option>Ù‚Ø³Ù… Ø§Ù„ØªÙ†Ø¸ÙŠÙ… ÙˆÙ…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø£Ø³ÙˆØ§Ù‚</option>
    <option>Ù‚Ø³Ù… Ø§Ù„ØªÙˆØ§ØµÙ„ ÙˆØ§Ù„Ø¥Ø¹Ù„Ø§Ù…</option>
    <option>Ù‚Ø³Ù… Ø§Ù„Ø´Ø¤ÙˆÙ† Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©</option>
  </select>

  <input type="text" id="searchInput" placeholder="ğŸ” Ø§Ø¨Ø­Ø« ÙÙŠ ÙƒÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ„">
</div>


  <table id="reportTable">
    <thead>
      <tr>
        <th>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙˆØ¸ÙŠÙÙŠ</th>
        <th>Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù</th>
        <th>Ø§Ù„Ù‚Ø³Ù…</th>
        <th>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</th>
        <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
        <th>Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„</th>
        <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
        <th>Ø¥Ø±ÙØ§Ù‚ Ù…Ø³ØªÙ†Ø¯</th>
        <th class="no-print">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</th>
      </tr>
    </thead>
    <tbody id="reportBody"></tbody>
  </table>

  <div id="buttons">
    <button onclick="window.print()">Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
    <button onclick="exportTableToExcel('reportTable', 'ØªÙ‚Ø§Ø±ÙŠØ±ÙŠ')">ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel</button>
    <button onclick="goBack()">Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</button>
  </div>
<script>
  const sheetEndpoint = "https://script.google.com/macros/s/AKfycbyz0B8kLryOcuZdGGV-wpda_sqYtzZA8vWh66rzkE5t_iHwcR0XNOlMlmZOdeuAM5qzAQ/exec";

  let allData = [];

  function loadData() {
    fetch(sheetEndpoint + "?action=getData")
      .then(res => {
        if (!res.ok) throw new Error("Network response was not ok");
        return res.json();
      })
      .then(data => {
        console.log("ØªÙ… Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:", data);
        allData = data;
        displayData(allData);
      })
      .catch(err => {
        console.error("Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:", err);
        alert("âŒ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
      });
  }

 function displayData(data) {
  const body = document.getElementById("reportBody");
  body.innerHTML = "";
  data.forEach(row => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${row.jobNumber || ""}</td>
      <td>${row.employeeName || ""}</td>
      <td>${row.department || ""}</td>
      <td>${row.email || ""}</td>
      <td>${formatDate(row.date)}</td>
      <td>${row.workType || ""}</td>
      <td>${row.notes || ""}</td>
      <td>
        ${row.fileUrl && row.fileUrl.startsWith("http")
          ? `<a href="${row.fileUrl}" target="_blank">ğŸ“ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø³ØªÙ†Ø¯</a>`
          : "Ù„Ø§ ÙŠÙˆØ¬Ø¯"}
      </td>
      <td class="no-print">
        <button onclick="confirmDelete(${row.rowNum})" class="delete-button">ğŸ—‘ Ø­Ø°Ù</button>
      </td>
    `;
    body.appendChild(tr);
  });
}



  document.getElementById("searchInput").addEventListener("input", function () {
    const filter = this.value.toLowerCase();
    const rows = document.querySelectorAll("#reportTable tbody tr");
    rows.forEach(row => {
      const match = Array.from(row.children).some(cell =>
        cell.textContent.toLowerCase().includes(filter)
      );
      row.style.display = match ? "" : "none";
    });
  });

  function filterByDepartment() {
    const selectedDept = document.getElementById("departmentFilter").value;
    const filteredData = selectedDept
      ? allData.filter(row => row.department === selectedDept)
      : allData;

    displayData(filteredData);
  }
function filterTable() {
  const jobNumberInput = document.getElementById("searchJobNumber").value.trim().toLowerCase();
  const nameInput = document.getElementById("searchEmployeeName").value.trim().toLowerCase();
  const rows = document.querySelectorAll("#employeeTable tbody tr");

  rows.forEach(row => {
    const jobNumber = row.cells[0].textContent.toLowerCase();
    const name = row.cells[1].textContent.toLowerCase();

    // Ø§Ù„Ø¨Ø­Ø« ÙŠØ¹Ù…Ù„ Ø¥Ø°Ø§ ØªØ­Ù‚Ù‚ Ø£Ø­Ø¯ Ø§Ù„Ø´Ø±Ø·ÙŠÙ† Ø£Ùˆ ÙƒÙ„Ø§Ù‡Ù…Ø§
    const matchJob = jobNumber.includes(jobNumberInput);
    const matchName = name.includes(nameInput);

    // Ø¥Ø°Ø§ ÙƒÙ„Ø§ Ø§Ù„Ø­Ù‚Ù„ÙŠÙ† ÙØ§Ø±ØºÙŠÙ†ØŒ Ù†Ø¸Ù‡Ø± ÙƒÙ„ Ø§Ù„ØµÙÙˆÙ
    if (!jobNumberInput && !nameInput) {
      row.style.display = "";
    } else if (matchJob || matchName) {
      row.style.display = "";
    } else {
      row.style.display = "none";
    }
  });
}

  function exportTableToExcel(tableID, filename = '') {
    const table = document.getElementById(tableID);
    const html = table.outerHTML;
    const blob = new Blob(["\ufeff", html], { type: "application/vnd.ms-excel" });
    const url = URL.createObjectURL(blob);
    const link = document.createElement("a");
    link.href = url;
    link.download = filename ? filename + '.xls' : 'ØªÙ‚Ø±ÙŠØ±.xls';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  }

  function goBack() {
    window.history.back();
  }

  function formatDate(dateStr) {
    if (!dateStr) return "";
    if (!isNaN(dateStr)) {
      const date = new Date(Math.round((dateStr - 25569) * 86400 * 1000));
      return `${date.getDate()}/${date.getMonth() + 1}/${date.getFullYear()}`;
    }
    const date = new Date(dateStr);
    if (isNaN(date)) return dateStr;
    return `${date.getDate()}/${date.getMonth() + 1}/${date.getFullYear()}`;
  }

  function confirmDelete(rowNum) {
    if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØµÙØŸ")) {
      deleteRow(rowNum);
    }
  }

  function deleteRow(rowNum) {
    fetch(sheetEndpoint, {
      method: "POST",
      headers: { "Content-Type": "application/x-www-form-urlencoded" },
      body: new URLSearchParams({
        action: "delete",
        rowNum: rowNum
      })
    })
      .then(res => res.json())
      .then(result => {
        if (result.status === "success") {
          alert("âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„ØµÙ Ø¨Ù†Ø¬Ø§Ø­");
          loadData();
        } else {
          alert("âŒ ÙØ´Ù„ Ø§Ù„Ø­Ø°Ù: " + result.message);
        }
      })
      .catch(() => alert("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…"));
  }

  loadData();
</script>

</body>
</html>
